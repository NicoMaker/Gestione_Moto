<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - Gestione Magazzino Moto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #667eea;
        --primary-dark: #5568d3;
        --primary-light: #e0e7ff;
        --secondary: #764ba2;
        --danger: #ef4444;
        --danger-light: #fee2e2;
        --dark: #1f2937;
        --gray: #6b7280;
        --gray-light: #f3f4f6;
        --white: #ffffff;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --radius: 12px;
        --radius-lg: 16px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        position: relative;
        overflow: hidden;
      }

      body::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        opacity: 0.3;
      }

      .login-container {
        background: var(--white);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-lg);
        width: 100%;
        max-width: 440px;
        padding: 48px;
        position: relative;
        animation: slideUp 0.5s ease-out;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .login-header {
        text-align: center;
        margin-bottom: 40px;
      }

      .login-icon {
        font-size: 64px;
        margin-bottom: 16px;
        display: block;
      }

      h1 {
        color: var(--dark);
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .login-subtitle {
        color: var(--gray);
        font-size: 15px;
      }

      .form-group {
        margin-bottom: 24px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--dark);
        font-size: 14px;
      }

      input {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e5e7eb;
        border-radius: var(--radius);
        font-size: 15px;
        transition: all 0.3s;
        background: var(--white);
        color: var(--dark);
      }

      input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px var(--primary-light);
      }

      .btn-login {
        width: 100%;
        padding: 14px 24px;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
        transition: all 0.3s;
        margin-top: 12px;
      }

      .btn-login:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px -5px rgba(102, 126, 234, 0.5);
      }

      .btn-login:active {
        transform: translateY(0);
      }

      .btn-login:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .alert {
        padding: 14px 16px;
        border-radius: var(--radius);
        margin-bottom: 24px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
        font-weight: 500;
        animation: slideDown 0.3s ease-out;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .alert-error {
        background: var(--danger-light);
        color: #991b1b;
        border-left: 4px solid var(--danger);
      }

      .alert-error::before {
        content: '‚ö†Ô∏è';
        font-size: 18px;
      }

      .loading-spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .footer-note {
        text-align: center;
        margin-top: 32px;
        padding-top: 24px;
        border-top: 1px solid #e5e7eb;
        color: var(--gray);
        font-size: 13px;
      }

      @media (max-width: 480px) {
        .login-container {
          padding: 32px 24px;
        }

        h1 {
          font-size: 24px;
        }

        .login-icon {
          font-size: 48px;
        }
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="login-header">
        <span class="login-icon">üèçÔ∏è</span>
        <h1>Gestione Magazzino Moto</h1>
        <p class="login-subtitle">Accedi per continuare</p>
      </div>

      <div id="alert-container"></div>

      <form id="login-form">
        <div class="form-group">
          <label for="username">Username</label>
          <input
            type="text"
            id="username"
            name="username"
            placeholder="Inserisci username"
            autocomplete="username"
            required
          />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Inserisci password"
            autocomplete="current-password"
            required
          />
        </div>

        <button type="submit" class="btn-login" id="login-btn">
          <span id="btn-text">Accedi</span>
        </button>
      </form>

      <div class="footer-note">
        üîí Accesso sicuro con crittografia bcrypt
      </div>
    </div>

    <script>
      const loginForm = document.getElementById('login-form');
      const loginBtn = document.getElementById('login-btn');
      const btnText = document.getElementById('btn-text');
      const alertContainer = document.getElementById('alert-container');

      // Controlla se l'utente √® gi√† loggato
      if (localStorage.getItem('isLoggedIn') === 'true') {
        window.location.href = '/index.html';
      }

      function showAlert(message) {
        alertContainer.innerHTML = `<div class="alert alert-error">${message}</div>`;
        setTimeout(() => {
          alertContainer.innerHTML = '';
        }, 5000);
      }

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        // Disabilita il pulsante e mostra loading
        loginBtn.disabled = true;
        btnText.innerHTML = '<span class="loading-spinner"></span> Accesso in corso...';

        try {
          const response = await fetch('/api/auth/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ username, password }),
          });

          const data = await response.json();

          if (response.ok) {
            // Login riuscito
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('username', data.username);
            
            // Reindirizza alla pagina principale
            window.location.href = '/index.html';
          } else {
            // Login fallito
            showAlert(data.error || 'Credenziali non valide');
            loginBtn.disabled = false;
            btnText.textContent = 'Accedi';
          }
        } catch (error) {
          console.error('Errore durante il login:', error);
          showAlert('Errore di connessione al server');
          loginBtn.disabled = false;
          btnText.textContent = 'Accedi';
        }
      });

      // Permetti l'invio con Enter
      document.getElementById('password').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          loginForm.dispatchEvent(new Event('submit'));
        }
      });
    </script>
  </body>
</html>